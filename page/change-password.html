<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1440, maximum-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="https://animaproject.s3.amazonaws.com/home/favicon.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Prompt:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="og:type" content="website" />
    <meta name="twitter:card" content="photo" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./../css/styles.css" />
</head>

<body>
    <div class="d-flex align-items-center div-main">
        <div class="d-flex align-items-center justify-content-center div-login">
            <div class="d-flex justify-content-center flex-column gap-2 form">
                <div class="pointer w-fit">
                    <div class="d-flex gap-2" onclick="goBack()">
                        <span class="material-icons fs-4">arrow_back_ios_new</span>
                        <span>Back to login</span>
                    </div>
                </div>
                <div class="spacer"></div>
                <span class="title">change your password?</span>
                <span class="sub-title">กรุณาตั้งรหัสผ่านอย่างน้อย 8 ตัวอักษร ควรหลีกเลี่ยงการใช้ชื่อผู้ใช้งาน หรือ
                    ข้อมูลส่วนตัวที่คาดเดาได้ง่าย เช่น วันเกิด</span>
                <div class="spacer"></div>
                <form action="" onsubmit="" id="myForm">
                    <div class="outlined-field">
                        <input type="password" id="oldPassword" class="outlined-input" placeholder=" " />
                        <label for="oldPassword">Old Password</label>
                        <span class="material-icons visibility-toggle" id="toggleOldPassword">visibility</span>
                    </div>
                    <div class="outlined-field">
                        <input type="password" id="newPassword" class="outlined-input" placeholder=" " />
                        <label for="newPassword">New Password</label>
                        <span class="material-icons visibility-toggle" id="toggleNewPassword">visibility</span>
                    </div>
                    <div class="d-flex flex-column gap-2">
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate1" disabled>
                            <span class="box"></span>
                            <span class="label">ความยาวอย่างน้อย 9 ตัวอักษรหรือตามที่ผู้ดูแลระบบกำหนด</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate2" disabled>
                            <span class="box"></span>
                            <span class="label">ประกอบด้วยตัวอักษรใหญ่ เช่น A, B, C และตัวอักษรเล็ก เช่น a, b, c</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate3" disabled>
                            <span class="box"></span>
                            <span class="label">ประกอบด้วยตัวเลข</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate4" disabled>
                            <span class="box"></span>
                            <span class="label">ประกอบด้วยสัญลักษณ์ ดังนี้ !, @, #, *, %, &, ?</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate5" disabled>
                            <span class="box"></span>
                            <span class="label">ยกเว้นสัญลักษณ์ ' - " $ ( ) , : ; [ ]^ _ [ ]~+<=> | / \</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate6" disabled>
                            <span class="box"></span>
                            <span class="label">ตัวอักษรและตัวเลขไม่เรียงซ้ำเกินกว่า 3 ตัว หรือเรียงกันตามลำดับ เช่น
                                aaaabbbb, 1111111, abcdefg</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="chkValidate7" disabled>
                            <span class="box"></span>
                            <span class="label">ไม่สามารถตั้งรหัสผ่านตรงกับ ชื่อผู้ใช้งานหรือชื่อโดเมน</span>
                        </label>

                    </div>
                    <div class="outlined-field">
                        <input type="password" id="confirmPassword" class="outlined-input" placeholder=" " />
                        <label for="confirmPassword">Confirm Password</label>
                        <span class="material-icons visibility-toggle" id="toggleConfirmPassword">visibility</span>
                    </div>
                    <div class="spacer"></div>
                    <button class="primary-btn pointer" type="button" id="btnChangePassword" onclick="openDialog()">Change
                        Password</button>
                </form>
            </div>
            <div class="d-flex justify-content-center bg">
                <div class="d-flex justify-content-center align-items-center p-3 card-bg">
                    <img src="./../assets/images/bg-change-password.png" alt="bg-login" class="w-full">
                </div>
            </div>
        </div>
    </div>

    <dialog class="forgetSuccess" id="myDialog">
        <div class="icon"><img src="./../assets/icons/icon-check.png" alt=""></div>
        <span class="title">ระบบได้ทำการส่งลิงก์สำหรับตั้งรหัสผ่านใหม่ไปยังอีเมลของคุณเรียบร้อยแล้ว</span>
        <span class="subTitle">กรุณาตรวจสอบกล่องจดหมาย (รวมถึงอีเมลขยะ) และดำเนินการตามขั้นตอนที่ระบุ</span>
        <button class="primary-btn" type="button" onclick="closeDialog()"><span
                class="material-icons">check</span>&nbsp;เข้าใจแล้ว</button>
    </dialog>

</body>

<script>
    const dialog = document.getElementById('myDialog');
    let username = 'aom';
    let isValid = false;
    const btnChangePassword = document.getElementById("btnChangePassword");
    const inputNewPassword = document.getElementById("newPassword");
    const inputConfirmPassword = document.getElementById("confirmPassword");


    window.onload = function () {
        btnChangePassword.disabled = true;
    };

    document.getElementById('toggleOldPassword').addEventListener('click', function () {
        const passwordInput = document.getElementById('oldPassword');
        const icon = this;
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.textContent = 'visibility_off';
        } else {
            passwordInput.type = 'password';
            icon.textContent = 'visibility';
        }
    });

    document.getElementById('toggleNewPassword').addEventListener('click', function () {
        const passwordInput = document.getElementById('newPassword');
        const icon = this;
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.textContent = 'visibility_off';
        } else {
            passwordInput.type = 'password';
            icon.textContent = 'visibility';
        }
    });

    document.getElementById('toggleConfirmPassword').addEventListener('click', function () {
        const passwordInput = document.getElementById('confirmPassword');
        const icon = this;
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.textContent = 'visibility_off';
        } else {
            passwordInput.type = 'password';
            icon.textContent = 'visibility';
        }
    });

    function goBack() {
        debugger
        window.history.back()
    }

    function openDialog() {
        dialog.showModal(); // เปิดแบบ Modal
    }

    function closeDialog() {
        dialog.close(); // ปิด Dialog
    }

    document.getElementById('newPassword').addEventListener('keyup', function (event) {
        // console.log('ปุ่มที่กด:', event.key, 'ค่า:', this.value);
        const regex1 = /^.{9,}$/;
        const regex2 = /^(?=.*[a-z])(?=.*[A-Z]).+$/;
        const regex3 = /^(?=.*\d).+$/;
        const regex4 = /^(?=.*[!@#*%&?]).+$/;
        const regex5 = /[^'\-"\$\(\),:;\[\]\^_~+<=>|/\\]/g;
        const regex6 = /(.)\1{3,}/;

        if (regex1.test(this.value)) {
            document.getElementById('chkValidate1').checked = true;
        } else {
            document.getElementById('chkValidate1').checked = false;
        }

        if (regex2.test(this.value)) {
            document.getElementById('chkValidate2').checked = true;
        } else {
            document.getElementById('chkValidate2').checked = false;
        }

        if (regex3.test(this.value)) {
            document.getElementById('chkValidate3').checked = true;
        } else {
            document.getElementById('chkValidate3').checked = false;
        }

        if (regex4.test(this.value)) {
            document.getElementById('chkValidate4').checked = true;
        } else {
            document.getElementById('chkValidate4').checked = false;
        }

        if (regex5.test(this.value)) {
            document.getElementById('chkValidate5').checked = true;
        } else {
            document.getElementById('chkValidate5').checked = false;
        }

        if (!regex6.test(this.value) && isInvalid(this.value) && this.value.length > 0) {
            document.getElementById('chkValidate6').checked = true;
        } else {
            document.getElementById('chkValidate6').checked = false;
        }

        if (this.value != username && this.value.length > 0) {
            document.getElementById('chkValidate7').checked = true;
        } else {
            document.getElementById('chkValidate7').checked = false;
        }

        const checkboxes = document.querySelectorAll("#myForm input[type='checkbox']");
        // ตรวจสอบว่า ทุกตัวถูกติ๊กครบหรือไม่
        const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
        if (allChecked && inputConfirmPassword.value == inputNewPassword.value) {
            btnChangePassword.disabled = false;
            btnChangePassword.style.cursor = 'pointer';
        } else {
            btnChangePassword.disabled = true;
            btnChangePassword.style.cursor = 'not-allowed';
        }
    });

    document.getElementById('confirmPassword').addEventListener('keyup', function (event) {
        const checkboxes = document.querySelectorAll("#myForm input[type='checkbox']");
        // ตรวจสอบว่า ทุกตัวถูกติ๊กครบหรือไม่
        const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
        if (allChecked && inputNewPassword.value == this.value) {
            btnChangePassword.disabled = false;
            btnChangePassword.style.cursor = 'pointer';
        } else {
            btnChangePassword.disabled = true;
            btnChangePassword.style.cursor = 'not-allowed';
        }
    })

    function isInvalid(str) {
        // ❌ ตรวจการเรียงตัวอักษร/ตัวเลข
        const chars = str.split('').map(ch => ch.charCodeAt(0));
        for (let i = 0; i < chars.length - 3; i++) {
            let ascending = true;

            // เช็คว่ามีอย่างน้อย 4 ตัวเรียงต่อกัน
            for (let j = 0; j < 3; j++) {
                if (chars[i + j] + 1 !== chars[i + j + 1]) {
                    ascending = false;
                    break;
                }
            }
            if (ascending) return false; // ❌ มีเรียงกัน
        }
        return true; // ✅ ผ่าน
    }

</script>

</html>